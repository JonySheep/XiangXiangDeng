
# 进销存系统软件体系结构描述文档v1.0

> **作者**：杨郁芩，邱浩旻，冉杰文，尚柯宇



##目录

[TOC]

## 更新历史

| 修改人员            | 日期         | 变更原因              | 版本号   |
| --------------- | ---------- | ----------------- | ----- |
| 杨郁芩、邱浩旻、冉杰文、尚柯宇 | 2017-10-23 | 完成体系结构阶段          | 1.0.0 |
| 邱浩旻             | 2017-10-26 | 更新期初建账            | 1.0.1 |
| 邱浩旻             | 2017-11-06 | 更新Commodity和Log部分 |       |






## 1.引言

### 1.1 编制目的

​    本文档详细完成对进销存系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

​    本报告面向开发人员、测试人员以及最终用户而编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义 | 备注   |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |

### 1.3 参考资料
进销存系统用例描述文档

进销存系统需求规格说明文档




## 2.产品概述

​    参考进销存系统用例描述文档和进销存系统需求规格说明文档中对产品的概括描述。




## 3.逻辑视角

​    进销存系统中，选择了分层体系结构风格，将系统分为三层（展示层，业务逻辑层，数据层），能够有效清晰的展示整个高层抽象。展示层包含GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。



**分层体系结构的逻辑视角**

![参照分层风格的包图表达逻辑视角](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/dev/doc/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%8F%82%E7%85%A7%E5%88%86%E5%B1%82%E9%A3%8E%E6%A0%BC%E7%9A%84%E5%8C%85%E5%9B%BE%E8%A1%A8%E8%BE%BE%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png)



**分层体系结构的逻辑设计方案**

![体系结构逻辑设计包图表达逻辑视角](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/dev/doc/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1%E5%8C%85%E5%9B%BE%E8%A1%A8%E8%BE%BE%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png)



## 4.组合视角

### 4.1 开发包图

**进销存系统的最终开发包设计**

| 开发（物理）包              | 依赖的其他开发包                                 |
| -------------------- | ---------------------------------------- |
| mainui               | commodityui,docuim,customerui,accountui,bookui,strategyui,userui,logui |
| commodityui          | commodityservice,界面库类包,vo                |
| commodityblservice   |                                          |
| commoditybl          | commodityblservice,commoditydataservice,po,logbl,userbl |
| commoditydataservice | Java RMI,po                              |
| commoditydata        | JavaRMI,po,databaseutility               |
| docui                | docblservice,界面类库包,vo                    |
| docblservice         |                                          |
| docbl                | docblservice,docdataservice,po,commoditybl,customerbl,accountbl,strategybl,userbl,logbl |
| docdataservice       | Java RMI,po                              |
| docdata              | Java RMI,po,databaseutility              |
| customerui           | customerblservice,界面类库包,vo               |
| customerblservice    |                                          |
| customerbl           | customerblservice,custumerdataservice,po,logbl,userbl |
| custumerdataservice  | Java RMI,po                              |
| cunstomerdata        | JavaRMI,po,databaseutility               |
| accountui            | accountblservice,界面类库包,vo                |
| accountblservice     |                                          |
| accountbl            | accountblservice,accountdataservice,po,logbl,userbl |
| accountdataservice   | Java RMI,po                              |
| accountdata          | JavaRMI,po,databaseutility               |
| bookui               | bookblservice,界面类库包,vo                   |
| bookblservice        |                                          |
| bookbl               | bookblservice,bookdataservice,po,logbl,userbl |
| bookdataservice      | JavaRMI,po                               |
| bookdata             | JavaRMI,po,databaseutility               |
| strategyui           | strategyblservice,界面类库包,vo               |
| strategyblservice    |                                          |
| strategybl           | strategyblservice,strategydataservice,po,strategybl,commoditybl,customerbl,logbl,userbl |
| strategydataservice  | JavaRMI,po                               |
| strategydata         | JavaRMI,po,databaseutility               |
| userui               | userblservice,界面类库包,vo                   |
| userblservice        |                                          |
| userbl               | userblservice,userdataservice,po,logbl,userbl |
| userdataservice      | JavaRMI,po                               |
| userdata             | JavaRMI,po,databaseutility               |
| logui                | logblservice,界面类库包,vo                    |
| logblservice         |                                          |
| logbl                | logblservice,logdataservice,po,logbl,userbl |
| logdataservice       | JavaRMI,po                               |
| logdata              | JavaRMI,po,databaseutility               |
| vo                   |                                          |
| po                   |                                          |
| untilitybl           | 备注：一些关于初始化和业务逻辑上下文的工作                    |
| factory              | 备注： 负责创建层间的具体对象实例                        |
| 界面类库包                |                                          |
| Java RMI             |                                          |
| databaseutility      |                                          |



**进销存系统客户端开发包图**

![进销存系统客户端开发包图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/temp-Dev2.0/doc/img/体系结构设计/客户端开发包图.png)

**进销存系统服务器端开发包图**



### 4.2 运行时进程

​    在进销存系统中，会有多个客户端进程和一个服务器端进程。结合部署图，客户端进程是在客户端机器上运行，服务器端进程在服务器端机器上运行。



**进程图**

![进程图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/dev/doc/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E8%BF%9B%E7%A8%8B%E5%9B%BE.png)



​	

### 4.3 物理部署

​    在进销存系统中，客户端构件是放在客户端机器上，服务器端构件是放在服务器端机器上。在客户端节点上，还要部署RMIStub构件。由于Java RMI构件属于JDK 8.0的一部分。所以在系统JDK环境已经设置好的情况下，不需要再独立部署。



**部署图**

![部署图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/dev/doc/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E9%83%A8%E7%BD%B2%E5%9B%BE.png)



## 5.接口视角

### 5.1 模块的职责

**客户端模块视图**
![客户端模块视图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/temp-Dev2.0/doc/img/体系结构设计/客户端模块视图.png)

**客户端各层职责**

| 层       | 职责                   |
| ------- | -------------------- |
| 启动模块    | 负责初始化网络通信机制，启动用户界面   |
| 用户界面层   | 基于窗口的进销存系统用户界面       |
| 业务逻辑层   | 对于用户界面的输入响应和业务处理逻辑   |
| 客户端网络模块 | 利用Java RMI 机制查找RMI服务 |



**服务器端模块视图**

![服务器端模块视图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/temp-Dev2.0/doc/img/体系结构设计/服务器端模块视图.png)

**服务器端各层职责**

| 层        | 职责                           |
| -------- | ---------------------------- |
| 启动模块     | 负责初始化网络通信机制，启动用户界面           |
| 数据层      | 负责数据的持久化及数据访问接口              |
| 服务器端网络模块 | 利用Java RMI 机制开启RMI服务，注册RMI服务 |


每一层只是使用下方直接接触的层。层与层之间仅仅通过接口调用来完成。

**层之间调用的接口**

| 接口                 | 服务调用方  | 服务提供方    |
| ------------------ | ------ | -------- |
| Commodityblservice | 客户端展示层 | 客户端业务逻辑层 |
| Accountblservice   | 客户端展示层 | 客户端业务逻辑层 |
| Customerblservice  | 客户端展示层 | 客户端业务逻辑层 |
| Docblservice       | 客户端展示层 | 客户端业务逻辑层 |
| Userblservice      | 客户端展示层 | 客户端业务逻辑层 |
| Logblservice       | 客户端展示层 | 客户端业务逻辑层 |
| Bookblservice      | 客户端展示层 | 客户端业务逻辑层 |
| Strategyblservice  | 客户端展示层 | 客户端业务逻辑层 |

| 接口                   | 服务调用方    | 服务提供方   |
| -------------------- | -------- | ------- |
| Commoditydataservice | 客户端业务逻辑层 | 服务器端数据层 |
| Accoutdataservice    | 客户端业务逻辑层 | 服务器端数据层 |
| Customerdataservice  | 客户端业务逻辑层 | 服务器端数据层 |
| Docdataservice       | 客户端业务逻辑层 | 服务器端数据层 |
| Logdataservice       | 客户端业务逻辑层 | 服务器端数据层 |
| Bookdataservice      | 客户端业务逻辑层 | 服务器端数据层 |
| Strategydataservice  | 客户端业务逻辑层 | 服务器端数据层 |
| Datafactoryservice   | 客户端业务逻辑层 | 服务器端数据层 |

借用日志功能来说明一下层之间的调用，如下图所示。每一层都是由上层依赖了一个接口（需接口），而下层实现了这个接口。LogBLService提供了Log界面做需要的所有业务逻辑功能。LogDataService提供了对数据库的增、删、改、查等操作。这样的实现降低了层与层之间的耦合。

**查看系统日志层之间的调用**

![查看系统日志层之间的调用](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/dev/doc/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD%E4%B9%8B%E9%97%B4%E8%B0%83%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3.png)

### 5.2 用户界面层的分解

根据需求，系统存在19个用户界面，包括登录界面，进货人员主界面，销售人员主界面，财务人员主界面，库存管理人员主界面，系统管理员主界面，总经理主界面，库存管理人员主界面，制定进货退货单界面，客户管理界面，制定销售及销售退货单据界面，查看、导出经营表单界面，制定财务单据界面，银行账户管理界面，管理系统用户界面，审批单据界面，制定促销策略界面，查看经营表单界面，商品管理界面，制定报溢／报损单据界面。



服务器端和客户端的用户界面设计接口是一致的，只是具体的页面不一样。



**界面跳转图**

![界面跳转图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/temp-Dev2.0/doc/img/体系结构设计/用户界面跳转图.png)



**用户界面类图**

//img11



#### 5.2.1 用户界面层模块的职责

| 模块          | 职责               |
| ----------- | ---------------- |
| MainUI      | 负责界面显示、控制界面跳转    |
| UserUI      | 负责提供、控制系统用户管理的界面 |
| BookUI      | 负责提供、控制期初建账的界面   |
| CustomerUI  | 负责提供、控制客户管理的界面   |
| AccountUI   | 负责提供、控制银行账户管理的界面 |
| DocUI       | 负责提供、控制制定单据的界面   |
| StrategyUI  | 负责提供、控制制定促销策略的界面 |
| CommodityUI | 负责提供、控制库存管理的界面   |
| LogUI       | 负责提、控制供查看日志的界面   |


#### 5.2.2 用户界面层模块的接口规范

##### 5.2.2.1 MainUI 模块 

| MainUI |                                    |
| ------ | ---------------------------------- |
| 语法     | void launch(String... args)        |
| 前置条件   | 无                                  |
| 后置条件   | 显示库存人员、进货人员、销售人员、财务人员、总经理和系统管理员的界面 |


###### 5.2.2.1.1 MainUI模块需要的服务接口

| 服务名                               | 服务              |
| --------------------------------- | --------------- |
| UserUIInfo.getLoginStage          | 提供一个给用于登录的用户界面  |
| UserUIInfo.getUserStage           | 返回一个系统用户管理的用户界面 |
| CommodityUIInfo.getCommodityStage | 返回一个库存管理的用户界面   |
| BookUIInfo.getBookStage           | 返回一个期初建账的用户界面   |
| CustomerUIInfo.getCustomerStage   | 返回一个客户管理的用户界面   |
| AccountUIInfo.getAccountStage     | 返回一个银行账户管理的用户界面 |
| DocUIInfo.getDocStage             | 返回一个制定单据的用户界面   |
| StrategyUIInfo.getStrategyStage   | 返回一个制定促销策略的用户界面 |
| LogUIInfo.getLogStage             | 返回一个查看系统日志的用户界面 |

#### 5.2.3 用户界面层模块需要的服务接口

| 服务名  | 服务   |
| ---- | ---- |
|      |      |
|      |      |

#### 5.2.4 用户界面模块设计原理

用户界面利用Java的javafx库来实现。


### 5.3 业务逻辑层的分解

业务逻辑层包括多个针对界面的业务逻辑处理对象。例如，Commidity对象负责处理库存管理界面的业务逻辑；doc对象负责处理单据界面的业务逻辑。

**业务逻辑层的设计**

![业务逻辑层设计图](http://101.37.19.32:10080/161250180/XiangXiangDeng/raw/temp-Dev2.0/doc/img/体系结构设计/业务逻辑层设计图.png)

#### 5.3.1 业务逻辑层模块的职责

| 层           | 职责                      |
| ----------- | ----------------------- |
| userbl      | 负责实现账户登录和账户管理所需要的服务     |
| bookbl      | 负责实现期初建账所需要的服务          |
| customerbl  | 负责实现客户管理所需要的服务          |
| accountbl   | 负责实现银行账户管理所需要的服务        |
| docbl       | 负责实现单据制定、审批、查看、导出所需要的服务 |
| strategybl  | 负责实现制定促销策略所需要的服务        |
| commoditybl | 负责实现库存管理、商品管理所需要的服务     |
| logbl       | 负责实现日志记录的服务             |


#### 5.3.2 业务逻辑层模块的接口规范

##### 5.3.2.1 Userbl模块的接口规范

###### 5.3.2.1.1   提供的服务（供接口）

| UserBLService.login                |                                          |
| ---------------------------------- | ---------------------------------------- |
| 语法                                 | public LoginState login(String id,long password) |
| 前置条件                               | 启动一个登录回合且password符合输入规则                  |
| 后置条件                               | 查询是否存在相应的User，根据输入的password返回登录验证        |
| **UserBLService.logout**           |                                          |
| 语法                                 | public LoginState logout()               |
| 前置条件                               | 启动一个登出回合                                 |
| 后置条件                               | 更新登录状态                                   |
| **UserBLService.reset**            |                                          |
| 语法                                 | public ResultMessage reset(String userID,String oldPassword,String newPassword) |
| 前置条件                               | 用户确定修改密码                                 |
| 后置条件                               | 返回修改状态                                   |
| **UserBLService.add**              |                                          |
| 语法                                 | public ResultMessage add(UserVO uservo)  |
| 前置条件                               | 启动一个增加用户回合                               |
| 后置条件                               | 数据库新增一客户信息                               |
| **UserBLService.search**           |                                          |
| 语法                                 | public UserVO search(String userID)      |
| 前置条件                               | 启动一个查找用户的回合                              |
| 后置条件                               | 返回符合条件的用户信息                              |
| **UserBLService.delete**           |                                          |
| 语法                                 | public ResultMessage delete(String userID) |
| 前置条件                               | 启动一个查找用户的回合                              |
| 后置条件                               | 数据库删除客户信息                                |
| **UserBLService.updateLevel**      |                                          |
| 语法                                 | public ResultMessage updateLevel(UserVO uservo) |
| 前置条件                               | 启动一个修改用户权限的回合                            |
| 后置条件                               | 数据库更新用户权限                                |
| **UserBLInfo.getCurrentUserID**    |                                          |
| 语法                                 | public String getCurrentUserID()         |
| 前置条件                               | 无                                        |
| 后置条件                               | 返回当前用户的ID                                |
| **UserBLInfo.getCurrentUserLevel** |                                          |
| 语法                                 | public UserLevel getCurrentUserLevel()   |
| 前置条件                               | 无                                        |
| 后置条件                               | 返回当前用户的权限                                |

###### 5.3.2.1.2  需要的服务（需接口）

| 服务名                                    | 服务              |
| -------------------------------------- | --------------- |
| UserDataService.insert(UserPO po)      | 插入单一持久化对象       |
| UserDataService.delete(String id)      | 删除单一持久化对象       |
| UserDataService.modifyLevel(UserPO po) | 修改单一持久化对象       |
| UserDataService.find(String if)        | 根据ID进行查找单一持久化对象 |
| UserDataService.login                  | 启动一个用户登录回合      |
| UserDataService.logout                 | 启动一个用户登出回合      |
| UserDataService.resetPassword          | 启动一个用户修改密码回合    |
| UserDataService.getCurrentUserID       | 得到当前用户的ID       |
| UserDataService.getCurrentUserLevel    | 得到当前用户的权限       |



##### 5.3.2.2 Bookbl模块的接口规范

###### 5.3.2.2.1   提供的服务（供接口）

| BookBLService.addBook     |                                          |
| ------------------------- | ---------------------------------------- |
| 语法                        | public ResultMessage addBook(BookDiscard discard) |
| 前置条件                      | 启动一个期初建账回合                               |
| 后置条件                      | 数据库保存新增的期初建账信息                           |
| **BookBLService.getBook** |                                          |
| 语法                        | public  ResultMessage getBook(String year, String kind) |
| 前置条件                      | 按年份和类型查询期初信息                             |
| 后置条件                      | 展示相应的期初信息                                |

###### 5.3.2.2.2  需要的服务（需接口）

| 服务名                  | 服务            |
| -------------------- | ------------- |
| BookDataService.mark | 标记新一个新财年的起初信息 |
| BookDataService.get  | 按年份和类型获得期初信息  |

##### 5.3.2.3 Customerbl模块的接口规范

###### 5.3.2.3.1   提供的服务（供接口）

| CustomerBLService.addCustomer        |                                          |
| ------------------------------------ | ---------------------------------------- |
| 语法                                   | public ResultMessage addCustomer(CustomerVO Customervo) |
| 前置条件                                 | 启动一个新增客户回合                               |
| 后置条件                                 | 返回新增客户成功与否                               |
| **CustomerBLService.deleteCustomer** |                                          |
| 语法                                   | public ResultMessage deleteCustomer(String CustomerID) |
| 前置条件                                 | 启动一个删除客户回合                               |
| 后置条件                                 | 返回删除客户成功与否                               |
| **CustomerBLService.modifyCustomer** |                                          |
| 语法                                   | public ResultMessage modifyCustomer(CustomerVO Customervo) |
| 前置条件                                 | 启动一个客户信息修改回合                             |
| 后置条件                                 | 返回修改客户信息成功与否                             |
| **CustomerBLService.search**         |                                          |
| 语法                                   | public ArrayList<CustomerVO> searchByName(String name) |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 根据客户名称模糊查找返回符合条件的用户列表                    |
| **CustomerBLService.getCustomer**    |                                          |
| 语法                                   | public ArrayList<CustomerVO> getCustomer() |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 得到所有客户对象                                 |
| **CustomerBLService.searchByID**     |                                          |
| 语法                                   | public ArrayList<CustomerVO> searchByID(String CustomerID) |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 根据客户编号模糊查找返回符合条件的用户列表                    |
| **CustomerInfo.getSupplier**         |                                          |
| 语法                                   | public ArrayList<CustomerVO> getSupplier() |
| 前置条件                                 | 用户需要获取供应商列表                              |
| 后置条件                                 | 返回供应商列表                                  |
| **CustomerInfo.getSaler**            |                                          |
| 语法                                   | public ArrayList<CustomerVO> getSaler()  |
| 前置条件                                 | 用户需要获取销售商列表                              |
| 后置条件                                 | 返回销售商列表                                  |

###### 5.3.2.3.2  需要的服务（需接口）

| 服务名                             | 服务            |
| ------------------------------- | ------------- |
| CustomerDataService.add         | 插入单一持久化对象     |
| CustomerDataService.delete      | 删除单一持久化对象     |
| CustomerDataService.modify      | 修改单一持久化对象     |
| CustomerDataService.search      | 通过名称查找单一持久化对象 |
| CustomerDataService.searchByID  | 通过ID查找单一持久化对象 |
| CustomerDataService.getSupplier | 获得供应商列表       |
| CustomerDataService.getSaler    | 获得销售商列表       |
| CustomerDataService.getCustomer | 得到所有单一持久化对象   |

##### 5.3.2.4 Accountbl模块的接口规范

###### 5.3.2.4.1   提供的服务（供接口）

| AccountBLService.newAccount             |                                          |
| --------------------------------------- | ---------------------------------------- |
| 语法                                      | public ResultMessage newAccount(AccountVO accountvo) |
| 前置条件                                    | 启动一个新增银行账户回合                             |
| 后置条件                                    | 数据库保存新增账户信息                              |
| **AccountBLService.searchBycardNumber** |                                          |
| 语法                                      | public ArrayList<AccountVO> searchBycardNumber(String cardNumber) |
| 前置条件                                    | 启动一个查询账户回合                               |
| 后置条件                                    | 返回符合条件的账户列表                              |
| **AccountBLService.searchBycardName**   |                                          |
| 语法                                      | public ArrayList<AccountVO> searchBycardName(String cardName) |
| 前置条件                                    | 启动一个查询账户回合                               |
| 后置条件                                    | 返回符合条件的账户列表                              |
| **AccountBLService.deleteAccount**      |                                          |
| 语法                                      | public ResultMessage delete(AccountVO accountvo) |
| 前置条件                                    | 启动一个删除账户回合                               |
| 后置条件                                    | 数据库删除该账户信息                               |
| **AccountBLService.modify**             |                                          |
| 语法                                      | public ResultMessage modify(AccountVO accountvo) |
| 前置条件                                    | 启动一个修改账户属性回合                             |
| 后置条件                                    | 数据库修改账户属性                                |
| **AccountBLInfo.getInfo**               |                                          |
| 语法                                      | public AccountVO getInfo()               |
| 前置条件                                    | 请求查看账户信息                                 |
| 后置条件                                    | 返回账户信息                                   |



###### 5.3.2.4.2  需要的服务（需接口）

| 服务名                                   | 服务              |
| ------------------------------------- | --------------- |
| DatabaseFacory.getUserDatabase        | 得到user数据库的服务的引用 |
| AccountDataService.delete             | 删除单一持久化对象       |
| AccountDataService.add                | 插入单一持久化对象       |
| AccountDataService.modify             | 修改单一持久化对象       |
| AccountDataService.getInfo            | 返回对象信息          |
| AccountDataService.searchBycardNumber | 根据银行卡号查找单一持久化对象 |
| AccountDataService.searchBycardName   | 根据账户名称查找单一持久化对象 |


##### 5.3.2.5 DocBL模块的接口规范

###### 5.3.2.5.1   提供的服务（供接口）

| DocBLService.CommodityCorrectingDoc      |                                          |
| ---------------------------------------- | ---------------------------------------- |
| 语法                                       | public ResultMessage CommodityCorrectingDoc () |
| 前置条件                                     | 用户发起报溢／报损单的制定                            |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.GetGoodTree**             |                                          |
| 语法                                       | public ArrayList<GoodVO> GetGoodList()   |
| 前置条件                                     | 用户需要显示商品层次列表                             |
| 后置条件                                     | 无                                        |
| **DocBLService.GoodPurchasingDoc**       |                                          |
| 语法                                       | public ResultMessage GoodPurchasingDoc() |
| 前置条件                                     | 用户发起进货单的制定                               |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.GoodPurchasingReturnDoc** |                                          |
| 语法                                       | public ResultMessage GoodPurchasingReturnDoc() |
| 前置条件                                     | 用户发起进货退货单的制定                             |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.GoodSaleDoc**             |                                          |
| 语法                                       | public ResultMessage GoodSaleDoc()       |
| 前置条件                                     | 用户发起销售单的制定                               |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.GoodSaleReturnDoc**       |                                          |
| 语法                                       | public ResultMessage GoodSaleReturnDoc() |
| 前置条件                                     | 用户发起销售退货单的制定                             |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.RecievingDoc**            |                                          |
| 语法                                       | public ResultMessage RecievingDoc()      |
| 前置条件                                     | 用户发起收款单的制定                               |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.PayingDoc**               |                                          |
| 语法                                       | public ResultMessage PayingDoc()         |
| 前置条件                                     | 用户发起付款单的制定                               |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.CashPayingDoc**           |                                          |
| 语法                                       | public ResultMessage CashPayingDoc()     |
| 前置条件                                     | 用户发起现金费用单的制定                             |
| 后置条件                                     | 返回新增单据成功与否                               |
| **DocBLService.SaleDetailCheckingDoc**   |                                          |
| 语法                                       | public ResultMessage SaleDetailCheckingDoc() |
| 前置条件                                     | 用户请求查看销售明细表                              |
| 后置条件                                     | 无                                        |
| **DocBLService.SaleDetailSelecting**     |                                          |
| 语法                                       | public DocVO SaleDetailSeleting(SaleDetailCheckingDocVO SDCDdocvo) |
| 前置条件                                     | 用户请求按不同分类筛选表单                            |
| 后置条件                                     | 系统显示经过筛选的表单                              |
| **DocBLService.ManageProcessCheckingDoc** |                                          |
| 语法                                       | public ResultMessage ManageProcessCheckingDoc() |
| 前置条件                                     | 用户请求查看经营历程表                              |
| 后置条件                                     | 无                                        |
| **DocBLService.ManageProcessSelecting**  |                                          |
| 语法                                       | public DocVO ManageProcessSelecting(.ManageProcessCheckingDocVO MPCdocvo) |
| 前置条件                                     | 用户请求按不同分类筛选表单                            |
| 后置条件                                     | 系统显示经过筛选的表单                              |
| **DocBLService.Writeback**               |                                          |
| 语法                                       | public ResultMessage Writeback(ManageProcessCheckingDocVO MPCdocvo) |
| 前置条件                                     | 用户发起红冲操作                                 |
| 后置条件                                     | 返回红冲成功与否，系统保存红冲后的表单                      |
| **DocBLService.ManageConditionCheckingDoc** |                                          |
| 语法                                       | public ResultMessage ManageConditionCheckingDoc() |
| 前置条件                                     | 用户请求查看经营情况表                              |
| 后置条件                                     | 无                                        |
| **DocBLService.ManageConditionSelecting** |                                          |
| 语法                                       | public DocVO ManageConditionSelecting(ManageConditionCheckingDocVO MCCdocvo) |
| 前置条件                                     | 用户请求按不同分类筛选表单                            |
| 后置条件                                     | 系统显示经过筛选的表单                              |
| **DocBLService.Exporting**               |                                          |
| 语法                                       | public ResultMessage Exporting(DocVO docvo) |
| 前置条件                                     | 用户请求导出表单                                 |
| 后置条件                                     | 返回导出成功与否                                 |
| **DocBLService.Examing**                 |                                          |
| 语法                                       | public ResultMessage Examing(DocVO docvo) |
| 前置条件                                     | 用户发起审批单据操作                               |
| 后置条件                                     | 返回审批通过与否，并更新所有单据列表                       |
| **DocBLService.multiExaming**            |                                          |
| 语法                                       | public ResultMessage multExaming(ArrayList<DocVO> docvo) |
| 前置条件                                     | 用户选择多张单据进行审批                             |
| 后置条件                                     | 返回审批通过与否，并更新所有单据列表                       |
| **DocBLService.Commit**                  |                                          |
| 语法                                       | public ResultMessage Commit(DocVO docvo) |
| 前置条件                                     | 用户选择提交单据                                 |
| 后置条件                                     | 返回提交成功与否                                 |
| **DocBLService.Delete**                  |                                          |
| 语法                                       | public ResultMessage Delete(DocVO docvo) |
| 前置条件                                     | 用户选择删除草稿单据                               |
| 后置条件                                     | 返回删除成功与否                                 |
| **DocBLService.Modify**                  |                                          |
| 语法                                       | public ResultMessage Modify(GoodSaleDocVO GSdocvo) |
| 前置条件                                     | 用户选择修改草稿单据                               |
| 后置条件                                     | 返回编辑成功与否，如果未做任何修改，则系统提示未做修改              |
| **DocBLService.GetList**                 |                                          |
| 语法                                       | public ArrayList<DocVO> GetList()        |
| 前置条件                                     | 用户需要显示单据列表                               |
| 后置条件                                     | 无                                        |

###### 5.3.2.5.2  需要的服务（需接口）

| 服务名                             | 服务                       |
| ------------------------------- | ------------------------ |
| CommodityBLInfo.getGoodTree     | 获得所有商品层次                 |
| CommodityBLInfo.updateCommodity | 根据报溢／报损／进货／退货／销售单据更新库存信息 |
| StrategyBLInfo.getStrategy      | 获得符合当前销售的促销策略            |
| CustomerBLInfo.getSupplierList  | 获得供应商客户列表                |
| CustomerBLInfo.geRetailerList   | 获得销售商客户列表                |
| AccoutBLInfo.getBalance         | 获得制定银行账户的余额              |
| AccoutBLInfo.updateAccout       | 根据收款／付款／现金费用单更新银行账户信息    |
| UserBLInfo.getUser              | 获得当前操作员                  |
| DocDataService.changeDocStatus  | 改变单据状态                   |
| DocDataService.addDoc           | 新增单据并且自动生成单据编号           |
| DocDataService.deleteDoc        | 删除单据                     |
| DocDataService.updateDoc        | 更新已修改单据                  |
| DocDataService.updateDocList    | 更新单据列表                   |
| DocDataService.getDocList       | 获得单据列表                   |
| DocDataService.getSaleRecord    | 获得近15天的销售记录              |
| DocDataService.getSaleIncome    | 获得近七天销售收入数据              |
| DocDataService.getTotalIncome   | 获得近七天折让后总收入数据            |
| DocDataService.getTotalDiscount | 获得近七天折让总额数据              |
| DocDataService.getGoodIncome    | 获得近七天商品类收入数据             |
| DocDataService.getSaleCost      | 获得近七天销售成本数据              |
| DocDataService.getTotalCost     | 获得近七天总支出数据               |
| DocDataService.getGoodCost      | 获得近七天商品类支出数据             |
| DocDataService.getProfit        | 获得近七天利润数据                |
| DatabaseFactory.getDocDatabase  | 得到Doc数据库的服务的饮用           |
| Docdatabase.inser               | 在数据库中插入DocPO对象           |



##### 5.3.2.6 StrategyBL模块的职责

###### 5.3.2.6.1 提供的服务（供接口）

| StrategyBLService.addCusStrategy      |                                          |
| ------------------------------------- | ---------------------------------------- |
| 语法                                    | public ResultMessage addCusStrategy(CustomerStrategyVO Cusstrategyvo) |
| 前置条件                                  | 新增用户制定客户回馈策略回合                           |
| 后置条件                                  | 返回新增成功与否                                 |
| **StrategyBLService.addPkgStrategy**  |                                          |
| 语法                                    | public ResultMessage addPkgStrategy(PackageStrategyVO Pkgstrategyvo) |
| 前置条件                                  | 新增用户制定组合降价策略回合                           |
| 后置条件                                  | 返回新增成功与否                                 |
| **StrategyBLService.addAmouStrategy** |                                          |
| 语法                                    | public ResultMessage addAmouStrategy(AmountStrategyVO AmouStrategyVO) |
| 前置条件                                  | 新增用户制定总额赠送策略回合                           |
| 后置条件                                  | 返回新增成功与否                                 |
| **StrategyBLService.deleteStrategy**  |                                          |
| 语法                                    | public ResultMessage deleteStrategy(StrategyVO strategyvo) |
| 前置条件                                  | 新增用户删除促销策略回合                             |
| 后置条件                                  | 返回删除成功与否                                 |
| **StrategyBLService.getStrategy**     |                                          |
| 语法                                    | public StrategyVO getStrategy(String id) |
| 前置条件                                  | 无                                        |
| 后置条件                                  | 返回需要得到的促销策略对象                            |
| **StrategyBLService.getCusStrategy**  |                                          |
| 语法                                    | public ArrayList<CustomerStrategyVO> getCusStrategy() |
| 前置条件                                  | 无                                        |
| 后置条件                                  | 返回所有客户回馈策略                               |
| **StrategyBLService.getPkgStrategy**  |                                          |
| 语法                                    | public ArrayList<PackageStrategyVO> getPkgStrategy() |
| 前置条件                                  | 无                                        |
| 后置条件                                  | 返回所有组合降价策略                               |
| **StrategyBLService.getAmouStrategy** |                                          |
| 语法                                    | public ArrayList<AmountStrategyVO> getAmouStrategy() |
| 前置条件                                  | 无                                        |
| 后置条件                                  | 返回所有总额赠送策略                               |
| **StrategyBLInfo.getGift**            |                                          |
| 语法                                    | public ArrayList<GiftItem>  getGift(int level,double amount) |
| 前置条件                                  | 用户需要在销售时获得赠品清单                           |
| 后置条件                                  | 返回赠品列表                                   |
| **StrategyBLInfo.checkValidPkg**      |                                          |
| 语法                                    | public ArrayList<PackageStrategyVO> checkValidPkg(ArrayList<SelectedGoodItem> goods) |
| 前置条件                                  | 用户需要获得可以使用的组合促销策略                        |
| 后置条件                                  | 无                                        |
| **StrategyBLInfo.getAmount**          |                                          |
| 语法                                    | public double getAmount(ArrayList<SelectedGoodItem> goods, ArrayList<PackageStrategyVO> SelectedStgs) |
| 前置条件                                  | 用户需要得到使用促销策略后的总价                         |
| 后置条件                                  | 返回计算得到的总价                                |
| **StrategyBLInfo.getDiscount**        |                                          |
| 语法                                    | public double getDiscount(int level)     |
| 前置条件                                  | 用户需要在销售时获得促销策略的折让价格                      |
| 后置条件                                  | 折让价格发生更新                                 |



###### 5.3.2.6.2 需要的服务（需接口）

| 服务名                                      | 服务              |
| ---------------------------------------- | --------------- |
| CommodityInfo.getGoodTree()              | 获得商品层次列表        |
| CommodityInfo.updateCommodity(ArrayList<String> goodIDList,ArrayList<Integer> amountList) | 根据赠品信息更新库存      |
| ResultMessage insertCusStrategy(CustomerStrategyPO cusstrategypo) | 新增客户回馈策略        |
| ResultMessage insertPkgStrategy(PackageStrategyPO pkgstrategypo) | 新增组合降价策略        |
| ResultMessage insertAmouStrategy(AmountStrategyPO amoustrategypo) | 新增总额赠送策略        |
| StrategyDataService.delete(StrategyPO strategypo) | 删除促销策略          |
| StrategtDataService.getStrategy()        | 获得所有促销策略        |
| CustomerStrategyPO getCurrentCusStrategy(LocalDate date, int level) | 获得满足要求的当前客户回馈策略 |
| ArrayList<PackageStrategyPO> getCurrentPkgStrategy(LocalDate date) | 获得满足要求的当前组合促销策略 |
| AmountStrategyPO getCurrentAmouStrategy(LocalDate date,double amount) | 获得满足要求的当前总额赠送策略 |
| ArrayList<CustomerStrategyVO> getCusStrategy() | 获得所有客户回馈策略      |
| ArrayList<PackageStrategyVO> getPkgStrategy() | 获得所有组合降价策略      |
| ArrayList<AmountStrategyVO> getAmouStrategy() | 获得所有总额赠送策略      |


##### 5.3.2.7 CommodityBL模块的接口规范

###### 5.3.2.7.1   提供的服务（供接口）

| CommodityBLService.getGoodTree        |                                          |
| ------------------------------------- | ---------------------------------------- |
| 语法                                    | public GoodTreeVO getGoodTree( )         |
| 前置条件                                  | 库存人员查看商品分类或完成商品分类的增删改移                   |
| 后置条件                                  | 返回现在的商品层次VO                              |
| **CommodityBLService.addCategory**    |                                          |
| 语法                                    | public CategoryVO addCategory(CategoryVO newCategoryVO, String newFatherID ) |
| 前置条件                                  | 库存人员填写新商品分类信息并提交                         |
| 后置条件                                  | 如果成功，返回新添加商品分类VO的引用；如果失败，返回null          |
| **CommodityBLService.moveCategory**   |                                          |
| 语法                                    | public CategoryVO moveCategory(String moveCategoryID, String newFatherID) |
| 前置条件                                  | 库存人员确认选择移动和移动至的商品分类                      |
| 后置条件                                  | 如果成功，返回新的所属分类的VO引用；如果失败，返回null           |
| **CommodityBLService.delCategory**    |                                          |
| 语法                                    | public ResultMessage delCategory(String delCategoryID) |
| 前置条件                                  | 库存人员确认删除选中的商品分类                          |
| 后置条件                                  | 返回一个结果消息                                 |
| **CommodityBLService.renameCategory** |                                          |
| 语法                                    | public ResultMessage renameCategory(String renameCategoryID, String newName) |
| 前置条件                                  | 库存人员确认重命名选中商品分类                          |
| 后置条件                                  | 返回一个结果消息                                 |
| **CommodityBLService.addGood**        |                                          |
| 语法                                    | public GoodVO addGood(GoodVO newGoodVO, String newFatherID) |
| 前置条件                                  | 库存人员查看商品或完成商品的增删改移                       |
| 后置条件                                  | 如果成功，返回新添加商品的VO引用；如果失败，返回null            |
| **CommodityBLService.moveGood**       |                                          |
| 语法                                    | public GoodVO moveGood(String moveGoodID, String newFatherID) |
| 前置条件                                  | 库存人员确认选择移动和移动至的商品                        |
| 后置条件                                  | 如果成功，返回新的所属分类的引用；如果失败，返回null             |
| **CommodityBLService.delGood**        |                                          |
| 语法                                    | public ResultMessage delGood(String delGoodID) |
| 前置条件                                  | 库存人员确认删除选中的商品分类                          |
| 后置条件                                  | 返回一个结果消息                                 |
| **CommodityBLService.renameGood**     |                                          |
| 语法                                    | public ResultMessage renameGood(String renameGoodID, String newName) |
| 前置条件                                  | 库存人员确认重命名选中商品                            |
| 后置条件                                  | 返回一个结果消息                                 |
| **CommodityBLService.searchGood**     |                                          |
| 语法                                    | public ArrayList<GoodVO> searchGood(String input, String CategoryID） |
| 前置条件                                  | 库存人员输入查询关键字或编号                           |
| 后置条件                                  | 如果有匹配，返回记录所有匹配的商品的列表的引用；如果失败，返回空列表       |
| **CommodityBLService.getCommodity**   |                                          |
| 语法                                    | public CommodityVO getCommodity(Date start, Date end) |
| 前置条件                                  | 库存管理人员输入查看时间段的起始时间和结束时间                  |
| 后置条件                                  | 显示此时间段内的库存变动信息                           |
| **CommodityBLService.export**         |                                          |
| 语法                                    | public ResultMessage export(File filepath, Date start, Date end) |
| 前置条件                                  | 库存管理人员输入导出位置                             |
| 后置条件                                  | 返回一个结果消息                                 |
| **CommodityBLInfo.getGoodTree**       |                                          |
| 语法                                    | public GoodTreeVO getGoodTree( )         |
| 前置条件                                  | 其他业务逻辑获取商品分类层次                           |
| 后置条件                                  | 返回现在的商品分类                                |
| **CommodityBLInfo.updateCommodity**   |                                          |
| 语法                                    | public ResultMessage updateCommodity(ArrayList<String> goodIDList, ArrayList<Integer> amountList) |
| 前置条件                                  | 其他业务逻辑更次库存商品                             |
| 后置条件                                  | 返回一个结果消息                                 |

###### 5.3.2.7.2   需要的服务（需接口）

| 服务名                                 | 服务        |
| ----------------------------------- | --------- |
| LogBLInfo.log                       | 添加系统日志    |
| CommodityDataService.getCategory    | 返回现在的商品层次 |
| CommodityDataService.addCategory    | 添加商品分类    |
| CommodityDataService.moveCategory   | 移动商品分类    |
| CommodityDataService.delCategory    | 删除商品分类    |
| CommodityDataService.renameCategory | 重命名商品分类   |
| CommodityDataService.addGood        | 添加商品      |
| CommodityDataService.moveGood       | 移动商品      |
| CommodityDataService.delGood        | 删除商品      |
| CommodityDataService.renameGood     | 重命名商品     |
| CommodityDataService.searchGood     | 搜索商品      |
| CommodityDataService.getCommodity   | 获得库存变动    |
| CommodityBLInfo.updateCommodity     | 更新库存商品    |

##### 5.3.2.8 LogBL模块的接口规范

###### 5.3.2.8.1   提供的服务（供接口）

| LogBLService.log      |                                     |
| --------------------- | ----------------------------------- |
| 语法                    | public ResultMessage log(LogVO log) |
| 前置条件                  | 有某个系统用户执行了重要操作                      |
| 后置条件                  | 返回一个结果消息                            |
| **LogBLInfo.log**     |                                     |
| 语法                    | public ResultMessage log(LogVO log) |
| 前置条件                  | 有某个系统用户执行了重要操作                      |
| 后置条件                  | 返回一个结果消息                            |
| **LogBLService.read** |                                     |
| 语法                    | public ArrayList<LogVO> read()      |
| 前置条件                  | 经理和财务人员查询日志                         |
| 后置条件                  | 返回日志                                |

###### 5.3.2.8.2   需要的服务（需接口）

| 服务名                 | 服务     |
| ------------------- | ------ |
| LogDataInfo.log     | 添加系统日志 |
| LogDataService.read | 获取系统日志 |



### 5.4 数据层的分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。



**数据层模块的描述图**




#### 5.4.1 数据层模块的职责

| 模块          | 职责                              |
| ----------- | ------------------------------- |
| DataService | 持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |


#### 5.4.2 数据层模块的接口规范

##### 5.4.2.1 UserData模板的接口规范

###### 5.4.2.1.1 提供的服务（供接口） 

| UserDataService.insert              |                                          |
| ----------------------------------- | ---------------------------------------- |
| 语法                                  | public void insert (UserPO po) throws RemoteException |
| 前置条件                                | 同样ID的po在数据库中不存在                          |
| 后置条件                                | 在数据库中增加一个po记录                            |
| **UserDataService.delete**          |                                          |
| 语法                                  | public void insert(UserPO po) throw RemoteException |
| 前置条件                                | 数据库中存在同样ID的po                            |
| 后置条件                                | 在数据库中删除po记录                              |
| **UserDataService.modifyLevel**     |                                          |
| 语法                                  | public void update(UserPO po) throws RemoteException |
| 前置条件                                | 在数据库中存在同样ID的po                           |
| 后置条件                                | 在数据库中修改po记录                              |
| **UserDataService.find**            |                                          |
| 语法                                  | public UserPO find(String id) throws RemoteException |
| 前置条件                                | 无                                        |
| 后置条件                                | 按id进行查找返回相应的UserPO结果                     |
| **UserDataService.login**           |                                          |
| 语法                                  | public boolean login(String id,String password) throws RemoteException |
| 前置条件                                | 无                                        |
| 后置条件                                | 更新登录状态                                   |
| **UserDataService.logout**          |                                          |
| 语法                                  | public boolean logout() throws RemoteException |
| 前置条件                                | 登录状态为已登录                                 |
| 后置条件                                | 更新登录状态                                   |
| **UserDataService.resetPassword**   |                                          |
| 语法                                  | public boolean resetPassword(String id,String oldPassword,newPassword) throws RemoteException |
| 前置条件                                | 账号和原密码输入正确                               |
| 后置条件                                | 更新用户密码                                   |
| **UserDataService.getCurrentID**    |                                          |
| 语法                                  | public String getCurrentID(UserPO po) throws RemoteException |
| 前置条件                                | 用户已登录                                    |
| 后置条件                                | 返回当前用户ID                                 |
| **UserDataService.getCurrentLevel** |                                          |
| 语法                                  | public Level getCurrntLevel(UserPO po) throws RemoteException |
| 前置条件                                | 用户已经登录                                   |
| 后置条件                                | 返回当前用户权限                                 |

##### 5.4.2.2 BookData模板的接口规范

###### 5.4.2.2.1 提供的服务（供接口）

| BookDataService.Mark    |                                          |
| ----------------------- | ---------------------------------------- |
| 语法                      | public ResultMessage mark(BookDiscard discard) throws RemoteExeption |
| 前置条件                    | BookBL调用                                 |
| 后置条件                    | 给新一财年的商品、客户和银行账户增加新一财年的标记                |
| **BookDataService.Get** |                                          |
| 语法                      | pulic BookVO get(String year, String kind) throws RemoteExeption |
| 前置条件                    | BookBL调用                                 |
| 后置条件                    | 返回相应的期初信息                                |

##### 5.4.2.3 CustomerData模板的接口规范

###### 5.4.2.3.1 提供的服务（供接口）

| CustomerDataService.insert           |                                          |
| ------------------------------------ | ---------------------------------------- |
| 语法                                   | public ResultMessage insert(CustomerPO customerpo) throws RemoteException |
| 前置条件                                 | 同样名字的po在数据库中不存在                          |
| 后置条件                                 | 数据库新增客户                                  |
| **CustomerDataService.delete**       |                                          |
| 语法                                   | public ResultMessage delete(String customerID) throws RemoteException |
| 前置条件                                 | 该customerID在数据库中存在                       |
| 后置条件                                 | 数据库删除客户                                  |
| **CustomerDataService.update**       |                                          |
| 语法                                   | public ResultMessage update(CustomerPO customerpo) throws RemoteException |
| 前置条件                                 | 修改信息符合规定                                 |
| 后置条件                                 | 数据库更新客户信息                                |
| **CustomerDataService.getCustomer**  |                                          |
| 语法                                   | public ArrayList<CustomerPO> get(String id) |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 返回所有客户对象                                 |
| **CustomerDataService.searchByname** |                                          |
| 语法                                   | public ArrayList<CustomerPO> searchByname(String name) throws RemoteException |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 数据库返回模糊查找符合信息的po列表                       |
| **CustomerDataService.searchByID**   |                                          |
| 语法                                   | public CustomerPO searchByID(String id) throws RemoteException |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 数据库返回模糊查找符合信息的po列表                       |
| **CustomerDataService.getSupplier**  |                                          |
| 语法                                   | public ArrayList<CustomerPO> getSupplier() throws RemoteException |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 数据库返回供应商客户列表                             |
| **CustomerDataService.getSaler**     |                                          |
| 语法                                   | public ArrayList<CustomerPO> getSaler() throws RemoteException |
| 前置条件                                 | 无                                        |
| 后置条件                                 | 数据库返回销售商客户列表                             |

##### 5.4.2.4 AccountData模板的接口规范

###### 5.4.2.4.1 提供的服务（供接口）

| AccountDataService.delete                |                                          |
| ---------------------------------------- | ---------------------------------------- |
| 语法                                       | public void delete(AccountPO po) throws RemoteException |
| 前置条件                                     | 数据库中存在响应的po                              |
| 后置条件                                     | 数据库删除相应的po                               |
| **AccountDataService.add**               |                                          |
| 语法                                       | public void add(AccountPO po) throws RemoteException |
| 前置条件                                     | 同样名称的po在数据库中不存在                          |
| 后置条件                                     | 数据库新增po                                  |
| **AccountDataService.modify**            |                                          |
| 语法                                       | public void modify(AccountPO po) throws RemoteException |
| 前置条件                                     | 数据库中存在相应的po                              |
| 后置条件                                     | 数据库修改对应的po                               |
| **AccountDataService.getInfo**           |                                          |
| 语法                                       | public AccountPO getInfo(string cardName) throws RemoteException |
| 前置条件                                     | 数据库中存在响应的po                              |
| 后置条件                                     | 返回相应的po                                  |
| **AccountDataService.searchBycardNumber** |                                          |
| 语法                                       | public AccountPO searchBycardNumber(String cardName) Throws RemoteException |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 按账号查找返回相应的AccountPO                      |
| **AccountDataService.searchBycardName**  |                                          |
| 语法                                       | public AccountPO searchBycardName(String cardName) Throws RemoteException |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 按账户名称查找并返回相应的AccountPO                   |

##### 5.4.2.5 docdata模块的接口规范

###### 5.4.2.5.1 提供的服务（供接口）

| Docdataservice.addDoc               |                                          |
| ----------------------------------- | ---------------------------------------- |
| 语法                                  | public boolean add(DocPO docpo)          |
| 前置条件                                | 无                                        |
| 后置条件                                | 新增一张单据，更新数据库中的单据信息                       |
| **Docdataservice.deleteDoc**        |                                          |
| 语法                                  | public boolean delete(DocPO docpo)       |
| 前置条件                                | 无                                        |
| 后置条件                                | 删除一张单据，更新数据库中的单据信息                       |
| **Docdataservice.updateDoc**        |                                          |
| 语法                                  | public  boolean updateDoc(DocPO docpo)   |
| 前置条件                                | 草稿单据被修改                                  |
| 后置条件                                | 更新数据库中的单据信息                              |
| **Docdataservice.updateDocList**    |                                          |
| 语法                                  | public boolean updateDocList(ArrayList<DocPO> list) |
| 前置条件                                | 单据数量或状态发生变化                              |
| 后置条件                                | 更新数据库中的单据信息                              |
| **Docdataservice.getDocList**       |                                          |
| 语法                                  | public ArrayList<DocPO> getDocList()     |
| 前置条件                                | 需要生成列表信息                                 |
| 后置条件                                | 返回所有单据信息                                 |
| **Docdataservice.changeDocStatus**  |                                          |
| 语法                                  | public boolean changeDocStatus(DocPO docpo) |
| 前置条件                                | 单据状态发生变化                                 |
| 后置条件                                | 更新数据库中的单据信息                              |
| **DocDataService.getSaleRecord**    |                                          |
| 语法                                  | public ArrayList<SaleRecordPO> getSaleRecord() |
| 前置条件                                | 需要获取销售记录                                 |
| 后置条件                                | 无                                        |
| **DocDataService.getSaleIncome**    |                                          |
| 语法                                  | public double getSaleIncome()            |
| 前置条件                                | 需要获取销售收入                                 |
| 后置条件                                | 返回总销售收入                                  |
| **DocDataService.getTotalIncome**   |                                          |
| 语法                                  | public double getTotalIncome()           |
| 前置条件                                | 需要获取折让后总收入                               |
| 后置条件                                | 返回折让后总收入                                 |
| **DocDataService.getTotalDiscount** |                                          |
| 语法                                  | public double getTotalDiscount()         |
| 前置条件                                | 需要获取折让总额                                 |
| 后置条件                                | 返回折让总额                                   |
| **DocDataService.getGoodIncome**    |                                          |
| 语法                                  | public double getGoodIncome()            |
| 前置条件                                | 需要获取商品类收入                                |
| 后置条件                                | 返回商品类收入                                  |
| **DocDataService.getSaleCost**      |                                          |
| 语法                                  | public double getSaleCost()              |
| 前置条件                                | 需要获取销售成本                                 |
| 后置条件                                | 返回销售成本                                   |
| **DocDataService.getTotalCost**     |                                          |
| 语法                                  | public double getTotalCost()             |
| 前置条件                                | 需要获取总支出                                  |
| 后置条件                                | 返回总支出                                    |
| **DocDataService.getGoodCost**      |                                          |
| 语法                                  | public double getGoodCost()              |
| 前置条件                                | 需要获取商品类支出                                |
| 后置条件                                | 返回商品类支出                                  |
| **DocDataService.getProfit**        |                                          |
| 语法                                  | public double getProfit()                |
| 前置条件                                | 需要获取利润                                   |
| 后置条件                                | 返回利润                                     |



##### 5.4.2.6 strategydata模块的接口规范

###### 5.4.2.6.1 提供的服务（供接口）

| StrategyDataService.insertCusStrategy    |                                          |
| ---------------------------------------- | ---------------------------------------- |
| 语法                                       | ResultMessage insertCusStrategy(CustomerStrategyPO cusstrategypo) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 插入一个客户回馈策略单一持久化对象                        |
| **StrategyDataService.insertPkgStrategy** |                                          |
| 语法                                       | ResultMessage insertPkgStrategy(PackageStrategyPO pkgstrategypo) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 插入一个组合降价策略单一持久化对象                        |
| **StrategyDataService.insertAmouStrategy** |                                          |
| 语法                                       | ResultMessage insertAmouStrategy(AmountStrategyPO amoustrategypo) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 插入一个总额赠送策略单一持久化对象                        |
| **StrategyDatsService.delete**           |                                          |
| 语法                                       | public ResultMessage delete(StrategyPO strategypo) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 删除一个单一持久化对象                              |
| **StrategyDataService.getStrategy**      |                                          |
| 语法                                       | public StrategyPO getStrategy(String id) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 得到单一持久化对象                                |
| **StrategyDataService.getCurrentCusStrategy** |                                          |
| 语法                                       | public ArrayList<CustomerStrategyPO> getCurrentCusStrategy(LocalDate CurrentDate,int level) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 返回当前进行的客户促销策略                            |
| **StrategyDataService.getCurrentPkgStrategy** |                                          |
| 语法                                       | public ArrayList<PackageStrategyPO> getCurrentPkgStrategy(LocalDate CurrentDate) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 返回当前进行的组合降价策略                            |
| **StrategyDataService.getCurrentAmouStrategy** |                                          |
| 语法                                       | public ArrayList<AmountStrategyPO> getCurrentAmouStrategy(LocalDate CurrentDate,double amount) |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 返回当前进行的总额赠送策略                            |
| **StrategyDataService.getCusStrategy**   |                                          |
| 语法                                       | public ArrayList<CustomerStrategyPO> getCusStrategy() |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 返回所有客户回馈策略                               |
| **StrategyDataService.getPkgStrategy**   |                                          |
| 语法                                       | public ArrayList<PackageStrategyPO> getPkgStrategy() |
| 前置条件                                     | 无                                        |
| 后置条件                                     | 返回所有组合降价策略                               |
| **StrategyDataService.getAmouStrategy**  |                                          |
| 语法                                       | public ArrayList<AmountStrategyPO> getAmouStrategy() |
| 前置条件                                     | 无                                        |
| 后置条件                                     |                                          |

##### 5.4.2.7 commoditydata模块的接口规范

###### 5.4.2.7.1   提供的服务（供接口）

| CommodityDataService.getGoodTree        |                                          |
| --------------------------------------- | ---------------------------------------- |
| 语法                                      | public GoodPO getCategory( )             |
| 前置条件                                    | 被CommunityBL的getCategory或getGoodTree调用   |
| 后置条件                                    | 返回现在的商品层次                                |
| **CommodityDataService.addCategory**    |                                          |
| 语法                                      | public Category addCategory(Category newCategory ) |
| 前置条件                                    | 被CommunityBL的addCategory调用               |
| 后置条件                                    | 如果成功，返回新添加商品分类的引用；如果失败，返回null            |
| **CommodityDataService.moveCategory**   |                                          |
| 语法                                      | public Category moveCategory(Category category, Category newFather) |
| 前置条件                                    | 被CommunityBL的moveCategory调用              |
| 后置条件                                    | 如果成功，返回新的所属分类的引用；如果失败，返回null             |
| **CommodityDataService.delCategory**    |                                          |
| 语法                                      | public ResultMessage delCategory(Category category ) |
| 前置条件                                    | 被CommunityBL的delategory调用                |
| 后置条件                                    | 返回一个结果消息                                 |
| **CommodityDataService.renameCategory** |                                          |
| 语法                                      | public ResultMessage renameCategory(Category category, String newName) |
| 前置条件                                    | 被CommunityBL的renameCategory调用            |
| 后置条件                                    | 返回一个结果消息                                 |
| **CommodityDataService.addGood**        |                                          |
| 语法                                      | public Good addGood(Good newGood)        |
| 前置条件                                    | 被CommunityBL的addGood调用                   |
| 后置条件                                    | 如果成功，返回新添加商品的引用；如果失败，返回null              |
| **CommodityDataService.moveGood**       |                                          |
| 语法                                      | public Good moveGood(Good father)        |
| 前置条件                                    | 被CommunityBL的moveGood调用                  |
| 后置条件                                    | 如果成功，返回新的所属分类的引用；如果失败，返回null             |
| **CommodityDataService.delGood**        |                                          |
| 语法                                      | public ResultMessage delGood(Good good)  |
| 前置条件                                    | 被CommunityBL的delGood调用                   |
| 后置条件                                    | 返回一个结果消息                                 |
| **CommodityDataService.renameGood**     |                                          |
| 语法                                      | public ResultMessage renameGood(String name) |
| 前置条件                                    | 被CommunityBL的renameGood调用                |
| 后置条件                                    | 返回一个结果消息                                 |
| **CommodityDataService.searchGood**     |                                          |
| 语法                                      | public ArrayList<Good> searchGood(String input) |
| 前置条件                                    | 被CommunityBL的searchGood调用                |
| 后置条件                                    | 如果有匹配，返回记录所有匹配的商品的数组的引用；如果失败，返回null      |
| **CommodityDataService.getCommodity**   |                                          |
| 语法                                      | public CommodityPO getCommodity(Date start, Date end) |
| 前置条件                                    | 被CommunityBL的getCoodity调用                |
| 后置条件                                    | 显示此时间段内的库存变动信息                           |
| **CommodityBLInfo.updateCommodity**     |                                          |
| 语法                                      | public ResultMessage updateCommodity(GoodListPO goodList) |
| 前置条件                                    | 被CommodityBL的updateCommodity调用           |
| 后置条件                                    | 返回一个结果消息                                 |

##### 5.4.2.8 logdata模块的接口规范

###### 5.4.2.8.1   提供的服务（供接口）

| LogDataService.log      |                                     |
| ----------------------- | ----------------------------------- |
| 语法                      | public ResultMessage log(LogPO log) |
| 前置条件                    | 被LogBLService调用                     |
| 后置条件                    | 添加系统日志                              |
| **LogDataService.read** |                                     |
| 语法                      | public ArrayList<LogPO> read()      |
| 前置条件                    | 被LogBLService调用                     |
| 后置条件                    | 无                                   |




## 6.信息视角


### 6.1 数据持久化对象

####6.1.1 UserPO

#### 6.1.2 AccountPO

#### 6.1.3 BookPO

#### 6.1.4 GoodPO


GoodPO包含商品ID，商品名称、商品型号、库存数量、警戒数量、进价、零售价、最近进价、最近零售价。

```java
public class GoodPO implements Serializable {
    Category good;

    public Category getGood() {
        return good;
    }
}
```


#### 6.1.5 CommodityPO

CommodityPO包含商品ID，商品原数量，商品现数量，变动时间和产生变动的单据编号。

```java
public class CommodityPO implements Serializable {
    String goodId;    
    int originalAmount;
    int nowAmount;
    Time time;
    String docid;

    CommodityPO(String goodId, int originalAmount, int nowAmount, Time time, String docid){
        this.goodId = goodId;
        this.originalAmount = originalAmount;
        this.nowAmount = nowAmount;
        this.time = time;
        this.docid = docid;
    }

    public String getGoodName() {
        return goodId;
    }

    public int getOriginalAmount() {
        return originalAmount;
    }

    public int getNowAmount() {
        return nowAmount;
    }

    public Time getTime() {
        return time;
    }

    public String getDocid() {
        return docid;
    }
}
```

#### 6.1.6 LogPO

LogPO包含操作名称，操作员，备注。

```java
public class LogPO implements Serializable {
    String operationName;
    User user;
    String remark;

    public String getOperationName() {
        return operationName;
    }

    public User getUser() {
        return user;
    }

    public String getRemark() {
        return remark;
    }
}
```

#### 6.1.7 CustomerPO

#### 6.1.8 StrategyPO

#### 6.1.9 DocPO

- DocPO类包含单据的`操作员`、`编号`、`状态属性`。

##### 6.1.9.1 CommdityCorrectingDocPO

##### 6.1.9.2 GoodPurchasingDocPO

##### 6.1.9.3 GoodPurchasingReturnPO

##### 6.1.9.4 GoodSaleDocPO

##### 6.1.9.5 GoodSaleReturnDocPO

##### 6.1.9.6 RecievingDocPO

##### 6.1.9.7 PayingDocPO

##### 6.1.9.8 CashPayingDocPO

##### 6.1.9.9 SaleDetailCheckingDocPO

##### 6.1.9.10 ManageProcessCheckingDocPO

##### 6.1.9.11 ManageConditionCheckingDocPO



### 6.2 Txt持久化格式



### 6.3 数据库表

